---
title: "<center>The Adaptive Learning Challenge</center>"
author: "Edwar Jose Londoño Correa <br> Andres Castrillón Velasquez <br> Diego Andres Chavarria Riaño <br> Sebastian Rendon Arteaga <br> Valentina Vanegas Castaño"
format: html
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = F,warning = F)
```

```{r}
library(kableExtra)
library(dplyr)
library(tidyverse)
library(stringr)
library(caret)
library(pander)
```

## 1- Contexto del problema

El objetivo de esta competencia es crear un modelo de aprendizaje automático capaz de predecir la probabilidad de que un estudiante determinado responda correctamente la siguiente pregunta, dada una secuencia previa de cien resoluciones.

```{r}
# Resouesta de las 100 preguntas por 20,000 usuarios

data1 <- read.csv("Dataset_model-1.csv", encoding = "UTF-8")
data2 <- read.csv("Dataset_model-2.csv", encoding = "UTF-8")
data3 <- read.csv("Dataset_model-3.csv", encoding = "UTF-8")
data4 <- read.csv("Dataset_model-4.csv", encoding = "UTF-8")
data5 <- read.csv("Dataset_model-5.csv", encoding = "UTF-8")
data6 <- read.csv("Dataset_model-6.csv", encoding = "UTF-8")
data7 <- read.csv("Dataset_model-7.csv", encoding = "UTF-8")
data8 <- read.csv("Dataset_model-8.csv", encoding = "UTF-8")
data9 <- read.csv("Dataset_model-9.csv", encoding = "UTF-8")
datos <- rbind(data1,data2,data3,data4,data5,data6,data7,data8,data9)

#respuestas enviadas por cada usuario
respuestas <- read.csv("Submit.csv", encoding = "UTF-8", sep = ";")
#head(datos)
```

## 2- Procesamiento de los datos

### 2.1- Selección de variables

Para la selección de las variables, se tomo en cuenta lo siguiente:

-   Se decide eliminar las variables "gp.college.type", "gp.degree.course", y "gp.school.type", ya que consideramos suficiente la información obtenida de la variable "gp.carrers".

-   Se decide eliminar las variables "city" y "region", ya que consideramos suficiente la información obtenida por país.

-   Se eliminan las variables "device", "device_type", "os", y "platform", ya que no se considera relevante la información del dispostivio en el que el usuario presenta el examen.

-   Las variables "gp:segment" , "commented_by_teacher" y "gp:source_project" son eliminadas ya que no se consideran relevantes para el estudio.

-   La variable "created_at" se elimina ya que no se considera relevante la fecha en que presento la pregunta, y "publication_year" también se elimina ya que no se considera importante el año en que se publicó la pregunta.

-   Las variables "row", "discipline_id", "examining_board_id", "institute_id", "novo_question_id", "knowledge_area_id", "product_id" y "novo_user_id" se eliminan ya que son variables de identificación.

```{r}
datos_modelo <- subset(datos, select = c(country,gp.carrers, gp.previous.experience, acertou,difficulty,modality_id,right_answer, scholarity_id, nullified, outdated))
```

```{r}
datos_modelo <- datos_modelo %>% mutate(country = ifelse(country ==  "" , NA, country))


datos_modelo <- datos_modelo %>% mutate(gp.carrers = ifelse(gp.carrers ==  "" , NA, gp.carrers))


datos_modelo <- datos_modelo %>% mutate(gp.previous.experience = ifelse(gp.previous.experience ==  "" , NA, gp.previous.experience))

datos_modelo <- datos_modelo %>% mutate(acertou = ifelse(acertou ==  "" , NA, acertou))

datos_modelo <- datos_modelo %>% mutate(difficulty = ifelse(difficulty ==  "" , NA, difficulty))

datos_modelo <- datos_modelo %>% mutate(modality_id = ifelse(modality_id ==  "" , NA, modality_id))

datos_modelo <- datos_modelo %>% mutate(right_answer = ifelse(right_answer ==  "" , NA, right_answer))

datos_modelo <- datos_modelo %>% mutate(scholarity_id = ifelse(scholarity_id ==  "" , NA, scholarity_id))

datos_modelo <- datos_modelo %>% mutate(nullified = ifelse(nullified ==  "" , NA, nullified))

datos_modelo <- datos_modelo %>% mutate(outdated = ifelse(outdated ==  "" , NA, outdated))
```

### 2.2- Análisis de las variables seleccionadas

#### Variable "country"

En la Tabla 1 podemos observar los valores únicos de esta variable. Para propósitos de estudio, solo se van a tener en cuenta los usuarios unicamente del país Brasil, los cuales son 19.836 usuarios de los 20.000 en total. Al hacer lo anterior, se va a proceder a eliminar esta variable, ya que ya no se considera relevante

```{r}
#Frecuencia

kable(head(datos_modelo %>% group_by(country) %>% summarise(n = n()) %>% arrange(-n),4),caption = "Los primeros valores únicos - Country") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 1.** Valores únicos de la variable "country"</center>

<br>

```{r}
datos_modelo <- datos_modelo[datos_modelo$country == "Brazil",]
datos_modelo <- datos_modelo[!is.na(datos_modelo$country),]
datos_modelo <- subset(datos_modelo, select = -c(country))
```

#### Variable "gp.carrers"

En la Tabla 2 podemos observar los valores únicos de esta variable, los cuales son 1.452. Esta variable indica la carrera o el grupo de carreras al que pertenece el usuario. Debido a que los usuarios pueden pertenecer a diferentes carreras, se tomará unicamente la primera carrera de cada grupo. Esta correción se puede ver en la Tabla 3.

```{r}
#Frecuencia

kable(head(datos_modelo %>% group_by(gp.carrers) %>% summarise(n = n()) %>% arrange(-n),10),caption = "Valores únicos - Carrers") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 2.** Valores únicos de la variable "gp.carrers"</center>

<br>

```{r}
carreras <-str_split_fixed(datos_modelo$gp.carrers, ",", 2)
carreras <- as.data.frame(carreras)
datos_modelo$gp.carrers <- carreras$V1

datos_modelo <- datos_modelo %>% mutate(gp.carrers = ifelse(gp.carrers ==  "" , NA, gp.carrers))

datos_modelo <- datos_modelo %>% mutate(gp.carrers = ifelse(gp.carrers ==  "Exercito" ,"Exército", gp.carrers))
```

```{r}
kable(datos_modelo %>% group_by(gp.carrers) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Carrers corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal
```

<center>**Tabla 3.** Valores únicos de la variable "gp.carrers" corregidos</center>

<br>

#### Variable "gp.previous.experience"

En la Tabla 4 podemos observar los valores únicos de esta variable, los cuales son "beginner", "experient", " professional" y "highly_experient". Esta variable indica la experiencia previa como examinado del servicio civil.

```{r}
#Frecuencia

kable(datos_modelo %>% group_by(gp.previous.experience) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Previous Experience") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 4.** Valores únicos de la variable "gp.previous.experience"</center>

<br>

#### Variable "difficulty"

En la Tabla 5 podemos observar los valores únicos de esta variable, los cuales son: "1", "2", "3", "4" y "5". Esta variable indica la dificultad de la pregunta. Para mayor entendimiento de la variable, se transforma de la siguiente manera: 1=level 1, 2= level 2, 3= level 3, 4= level 4 y 5= level 5. Lo anterior se puede ver en la Tabla 6.

```{r}
#Frecuencia

kable(head(datos_modelo %>% group_by(difficulty) %>% summarise(n = n()) %>% arrange(-n),10),caption = "Valores únicos - Difficulty") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 5.** Valores únicos de la variable "difficulty"</center>

<br>

```{r}
datos_modelo$difficulty <- as.factor(datos_modelo$difficulty)
datos_modelo <- datos_modelo %>% 
  mutate(difficulty = recode(difficulty,
                             "1" = "level_1",
                             "2" = "level_2",
                             "3" = "level_3",
                             "4" = "level_4",
                             "5" = "level_5"))
```

```{r}

kable(head(datos_modelo %>% group_by(difficulty) %>% summarise(n = n()) %>% arrange(-n),10),caption = "Valores únicos - Difficulty corregido") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 6.** Valores únicos de la variable "difficulty" corregidos</center>

<br>

#### Variable "modality_id"

En la Tabla 7 podemos observar los valores únicos de esta variable, los cuales son "1" y "2". Esta variable indica el tipo de pregunta (Selección multiple o correcto/incorrecto). Para mejor entendimiento, se cambiará los valores 1 por S_M y el valor 2 por V_F. Lo anterior se puede ver en la Tabla 8.

```{r}
#Frecuencia

kable(datos_modelo %>% group_by(modality_id) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Modality") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 7.** Valores únicos de la variable "modality_id"</center>

<br>

```{r}
datos_modelo$modality_id <- as.factor(datos_modelo$modality_id)
datos_modelo <- datos_modelo %>% 
  mutate(modality_id = recode(modality_id,
                              "1" = "S_M",
                              "2" = "V_F"))
```

```{r}

kable(datos_modelo %>% group_by(modality_id) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Modality corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 8.** Valores únicos de la variable "modality_id" corregidos</center>

<br>

#### Variable "right_answer"

En la Tabla 9 podemos observar los valores únicos de esta variable. Esta variable indica la respuesta correcta de la pregunta. Se cambiaran los valores diferentes a A,B, C, D y E por NA. Lo anterior se puede ver en la Tabla 10.

```{r}
#Frecuencia

kable(head(datos_modelo %>% group_by(right_answer) %>% summarise(n = n()) %>% arrange(-n),10),caption = "Valores únicos - Right Answer") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 9.** Valores únicos de la variable "right_answer"</center>

<br>

```{r}
datos_modelo <- datos_modelo %>% mutate(right_answer = ifelse(right_answer ==  "X" , NA, right_answer))
datos_modelo <- datos_modelo %>% mutate(right_answer = ifelse(right_answer ==  "*" , NA, right_answer))
datos_modelo <- datos_modelo %>% mutate(right_answer = ifelse(right_answer ==  "+" , NA, right_answer))
```

```{r}

kable(head(datos_modelo %>% group_by(right_answer) %>% summarise(n = n()) %>% arrange(-n),10),caption = "Valores únicos - Right Answer corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 10.** Valores únicos de la variable "right_answer" corregidos</center>

<br>

#### Variable "scholarity_id"

En la Tabla 11 podemos observar los valores únicos de esta variable, los cuales son "1", "2" y "3". Esta variable indica el nivel educativo de la pregunta. Para mayor entendimiento, los valores se van a transformar por: 1= level_1, 2= level_2 y 3= level_3. Lo anterior se puede ver en la Tabla 12.

```{r}
#Frecuencia

kable(datos_modelo %>% group_by(scholarity_id) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Scholarity") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 11.** Valores únicos de la variable "scholarity_id"</center>

<br>

```{r}
datos_modelo$scholarity_id <- as.factor(datos_modelo$scholarity_id)
datos_modelo <- datos_modelo %>% 
  mutate(scholarity_id = recode(scholarity_id,
                              "1" = "level_1",
                              "2" = "level_2",
                              "3" = "level_3"))
```

```{r}

kable(datos_modelo %>% group_by(scholarity_id) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Scholarity Corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 12.** Valores únicos de la variable "scholarity_id" corregidos</center>

<br>

#### Variable "nullified"

En la Tabla 13 podemos observar los valores únicos de esta variable, los cuales son "0" y "1". Esta variable indica si la pregunta fue cancelada. Para mayor entendimiento de la variable, se transforma de la siguiente manera: 0=No y 1= Yes. Lo anterior se puede ver en la Tabla 14.

```{r}
#Frecuencia

kable(datos_modelo %>% group_by(nullified) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Nullified") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 13.** Valores únicos de la variable "nullified"</center>

<br>

```{r}
datos_modelo$nullified <- as.factor(datos_modelo$nullified)
datos_modelo <- datos_modelo %>% 
  mutate(nullified = recode(nullified,
                              "0" = "No",
                              "1" = "Yes"))
```

```{r}

kable(datos_modelo %>% group_by(nullified) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Nullified corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 14.** Valores únicos de la variable "nullified" corregida</center>

<br>

#### Variable "outdated"

En la Tabla 15 podemos observar los valores únicos de esta variable, los cuales son "0" y "1". Esta variable indica si la pregunta es desactualizada. Para mayor entendimiento de la variable, se transforma de la siguiente manera: 0=No y 1= Yes. Lo anterior se puede ver en la Tabla 16.

```{r}
#Frecuencia

kable(datos_modelo %>% group_by(outdated) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Outdated") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 15.** Valores únicos de la variable "outdated"</center>

<br>

```{r}
datos_modelo$outdated <- as.factor(datos_modelo$outdated)
datos_modelo <- datos_modelo %>% 
  mutate(outdated = recode(outdated,
                              "0" = "No",
                              "1" = "Yes"))
```

```{r}
kable(datos_modelo %>% group_by(outdated) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Outdated corregidos") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 16.** Valores únicos de la variable "outdated" corregidos</center>

<br>

```{r}
datos_modelo$gp.carrers <- as.factor(datos_modelo$gp.carrers)
datos_modelo$gp.previous.experience <- as.factor(datos_modelo$gp.previous.experience)
datos_modelo$acertou <- as.factor(datos_modelo$acertou)
datos_modelo$difficulty <- as.factor(datos_modelo$difficulty)
datos_modelo$modality_id <- as.factor(datos_modelo$modality_id)
datos_modelo$right_answer <- as.factor(datos_modelo$right_answer)
datos_modelo$scholarity_id <- as.factor(datos_modelo$scholarity_id)
datos_modelo$nullified <- as.factor(datos_modelo$nullified)
datos_modelo$outdated <- as.factor(datos_modelo$outdated)
```

### 2.3- Análisis de valores NA

En la Tabla 17 podemos observar los valores, NA por cada variable de la base de datos.

```{r}
#Cantidad de registros nulos

kable(apply(is.na(datos_modelo),2,sum),caption = "Valores NA") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 17.** Cantidad de valores NA de cada variable de la base datos</center>

<br>

Se puede observar que las variables "modality_id", "scholarity_id", "nullified" y "outdated" se tiene la misma cantidad de valores NA. En la Tabla 18 se observa los registros donde se evidencia esto.

```{r}

kable(head(datos_modelo[is.na(datos_modelo$modality_id),],5),caption = "Registros del dataset") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 18.** Registros del dataset donde las variables "modality_id", "scholarity_id", "nullified" y "outdated" son NA</center>

<br>

En la Tabla 18 podemos observar que se cumple que en los 178 registros donde las variables "modality_id", "scholarity_id", "nullified" y "outdated" son NA, son los mismos. Se procede a eliminar estos registros.

```{r}
datos_modelo <- datos_modelo[!is.na(datos_modelo$modality_id),]
```

En la Tabla 19, se vuelve a calcular la cantidad de valores NA por cada variable.

```{r}
kable(apply(is.na(datos_modelo),2,sum),caption = "Valores NA") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 19.** Cantidad de valores NA de cada variable de la base datos</center>

<br>

Para las variables "gp.carrers',"gp.previous.experience" y "difficulty", se les va a sustituir sus valores NA por el valor de la moda.

```{r}
datos_modelo$gp.carrers[is.na(datos_modelo$gp.carrers)] <- "Policial"
datos_modelo$gp.previous.experience[is.na(datos_modelo$gp.previous.experience)] <- "beginner"
datos_modelo$difficulty[is.na(datos_modelo$difficulty)] <- "level_2"
```

Para la variable "right_answer", los valores NA se van a sustituir por el valor de la moda, de acuerdo las posibles respuesta dependiendo del tipo de pregunta (modality_id).

```{r}
div1 <- datos_modelo[datos_modelo$modality_id=="S_M",]
div2 <- datos_modelo[datos_modelo$modality_id=="V_F",]
```

En la Tabla 20, podemos observar la cantidad de valores de cada valor único de la variable "right_answer" cuando la variable modality_id es igual a S_M. Y en la Tabla 21, podemos observar la cantidad de valores de cada valor único de la variable "right_answer" cuando la variable modality_id es igual a V_F

```{r}
kable(div1 %>% group_by(right_answer) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Right Answer") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 20.** Valores únicos de la variable "right_answer" cuando modality_id = S_M</center>

<br>

```{r}

kable(div2 %>% group_by(right_answer) %>% summarise(n = n()) %>% arrange(-n),caption = "Valores únicos - Right Answer") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 21.** Valores únicos de la variable "right_answer" cuando modality_id = V_F</center>

<br>

En la Tabla 21, se observa un valor único "D" . Estos valores serán cambiados por el valor NA, ya que los únicos valores permidos para la variable "right_answer" cuando la variable "modality_id" es igual a V_F, son E y C.

```{r}
datos_modelo$right_answer[(datos_modelo$modality_id=="V_F" & datos_modelo$right_answer == "D")] <- NA

datos_modelo$right_answer[(datos_modelo$modality_id=="V_F" & is.na(datos_modelo$right_answer))] <- "E"

datos_modelo$right_answer[(datos_modelo$modality_id=="S_M" & is.na(datos_modelo$right_answer))] <- "C"
```

Una vez corregido los valores NA de la variable "right_answer" por sus respectiva moda, en la Tabla 22 se puede observar las nuevas cantidades de valores NA por variable.

```{r}
kable(apply(is.na(datos_modelo),2,sum),caption = "Valores NA") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 22.** Cantidad de valores NA de cada variable de la base datos</center>

<br>

### 2.4- Transformación de las variables categóricas

Se convierten las variables categóricas a variables dummy, exceptuando la variable objetivo ("acertou"). Hay que tener en cuenta que todas las variables de la base de datos son categóricas. Con lo anterior, se obtiene un dataset con las dimensiones que se puede ver en la Tabla 23.

```{r}
Y <- as.data.frame(datos_modelo$acertou)
datos_modelo <- subset(datos_modelo, select = -c(acertou))
onehotencoding <- dummyVars(~.,data = datos_modelo)
X <- as.data.frame(predict(onehotencoding,datos_modelo))
datos_modelo <- as.data.frame(cbind(X,Y))
```

```{r}
size <- data.frame(Filas=nrow(datos_modelo),Columnas = ncol(datos_modelo))

kable(size,caption = "Tamaño del dataset") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 23.** Dimensiones del dataset</center>

<br>

## 3- Modelo predictivo

Ya con la limpieza realizada a los datos, se procede con la creación del modelo de predicción. Para realizar el modelo, se escoge el algoritmo KNN (K vecinos más cercanos). Este algoritmo "es un clasificador de aprendizaje supervisado no paramétrico, que utiliza la proximidad para hacer clasificaciones o predicciones sobre la agrupación de un punto de datos individual"(IBM, 2022).

### 3.1- Transformación de la variable objetivo

Como paso inicial para la creación del modelo, se transforma la variable objetivo "Acertou" la cual tiene valores 0 y 1, a valores "No" o "Yes" respectivamente.

```{r}
colnames(datos_modelo)[38] <- "Acertou"
datos_modelo$Acertou <- factor(datos_modelo$Acertou, levels = c("0", "1"), labels = c("No", "Yes"))
```

### 3.2- División del conjunto de datos en entrenamiento y validación

El conjunto de datos se va a dividir de la siguiente forma: 80% para el conjunto de entrenamiento y el 20% para el conjunto de validación.

```{r}
set.seed(20)
n_muestra <- dim(datos_modelo)[1]
p_vl <- 0.2 # proporción de datos para validación
ix_vl <- sample(n_muestra,size = round(n_muestra*p_vl),
                replace = FALSE)
datos_vl <- datos_modelo[ix_vl,]
datos_tr <- datos_modelo[-ix_vl,]
```

Se realiza una revisión de la tasa de la variable "aciertos" en los conjuntos de entrenamiento y de validación.

```{r}
kable(proportions(table(datos_tr$Acertou)),caption = "Proporción de la variable Acertou en el conjunto de entrenamiento") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 24.** Proporción de la variable Acertou en el conjunto de entrenamiento</center>

<br>

```{r}
kable(proportions(table(datos_vl$Acertou)),caption = "Proporción de la variable Acertou en el conjunto de validación") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  kable_minimal()
```

<center>**Tabla 25.** Proporción de la variable Acertou en el conjunto de entrenamiento</center>

<br>

Como se puede ver en las Tablas 24 y 25, se mantiene la misma proporción de la variable "aciertos" en ambos conjuntos de datos.

```{r}
#Se divide ambos conjuntos en variables X y Y.

## Conjunto de entrenamiento
X_tr <- subset(datos_tr,select = -c(Acertou))
Y_tr <- datos_tr$Acertou
Y_tr <- as.factor(Y_tr)

## Conjunto de validacion
X_vl <- subset(datos_vl,select = -c(Acertou))
Y_vl <- datos_vl$Acertou
Y_vl <- as.factor(Y_vl)
```

### 3.3- A.C.P (Análisis de las componentes principales)

Se realiza un Análisis de Componentes Principales para la selección de las variables, el cual se puede ver en la Tabla 26. Para conservar el 91.42% de la variabilidad explicada en las variables, se va a trabajar con las primeras 11 componentes principales.

```{r}
#Se realiza el calculo del ACP
ACP <- prcomp(X_tr, center = FALSE)

p<-summary(ACP)
pander(p[["importance"]])
```

<center>**Tabla 26.** Análisis de Componentes Principales</center>

<br>

```{r}
#Se seleccionan las primeras 11 componentes principales
X_tr_acp <- data.frame(ACP$x[,1:11])
```

### 3.4- valor K óptimo

Como criterio,,jjddjdj

```{r}
#función para encontrar el valor optimo K

optimo_K <- function(k,X_t,Y_t){
  
  modelo_knn <- knn3(x=X_t, y = Y_t, k = k)
  predicciones_train <- predict(modelo_knn, newdata = X_t, type = "class")
  
  mat_conf <- table(predicciones_train,Y_t)
  accuracy <- sum(diag(mat_conf))/sum(mat_conf)
  sensibilidad <- mat_conf[1,1]/(mat_conf[1,1]+mat_conf[2,1])
  especificidad <-    mat_conf[2,2]/(mat_conf[2,2]+mat_conf[1,2])
  resultado <- list(accuracy=accuracy,
                    sensibilidad=sensibilidad,
                    especificidad=especificidad)
  return(resultado)
}
```

```{r}
k <- 2:30

#resultados <- optimo_K(k=3, X_t=X_tr_acp,Y_t=Y_tr)
#resultados <- t(resultados)

#rownames(resultados) <- 1:nrow(resultados)
#resultados <- as.data.frame(resultados)
#resultados$Valor_K <- k
```

## Referencias

-   IBM. (2022). Algoritmo de k vecinos más cercanos. 2022, noviembre 24, de ibm.com. Sitio web: https://www.ibm.com/co-es/topics/knn
